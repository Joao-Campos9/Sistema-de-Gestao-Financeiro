<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if month == 0 %}
        <title>Home - Geral/{{ year }}</title>
    {% else %}
        <title>Home - {{ month }}/{{ year }}</title>
    {% endif %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Registros</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row justify-content-between">
        <div class="col-4">
            <h2 class="mb-4">Lista de Registros</h2>
        </div>
        <div class="col-4">
            {% include "partials/filter_registry.html" %}
        </div>
    </div>
    
    <table class="table table-striped bg-white shadow-sm">
        <thead>
            <tr>
                <th>ID</th>
                <th>Descrição</th>
                <th>Valor</th>
                <th>Categoria</th>
                <th>Tipo</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% if month == 0 %}
                {% for i in registry %}
                    {% if year == i.date[0:4]|int %}
                        <tr>    
                            <td>{{ i.id }}</td>
                            <td>{{ i.description }}</td>
                            {% if i.value < 0 %}
                                <td class="text-danger">R$ {{ i.value|abs|round(2) }}</td>
                            {% else %}
                                <td class="text-success">R$ {{ i.value|round(2) }}</td>
                            {% endif %}
                            <td>{{ i.category }}</td>
                            <td>{{ i.type }}</td>
                                <td>
                                    <form action="/register/edit/{{ i.id }}" method="POST">
                                        <button class="btn btn-success btn-sm">Editar</button>
                                    </form>
                                </td>
                                <td>
                                    <form action="{{ url_for('register.remover_register', id=i.id, month=month, year=year) }}" method="POST">
                                        <button class="btn btn-danger btn-sm">Remover</button>
                                    </form>
                                </td>
                            
                            <td>
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
            {% else %}
                {% for i in registry %}
                    {% if month == i.date[5:7]|int and year == i.date[0:4]|int %}
                        <tr>    
                            <td>{{ i.id }}</td>
                            <td>{{ i.description }}</td>
                            {% if i.value < 0 %}
                                <td class="text-danger">R$ {{ i.value|abs|round(2) }}</td>
                            {% else %}
                                <td class="text-success">R$ {{ i.value|round(2) }}</td>
                            {% endif %}
                            <td>{{ i.category }}</td>
                            <td>{{ i.type }}</td>
                                <td>
                                    <form action="/register/edit/{{ i.id }}" method="POST">
                                        <button class="btn btn-success btn-sm">Editar</button>
                                    </form>
                                </td>
                                <td>
                                    <form action="{{ url_for('register.remover_register', id=i.id, month=month, year=year) }}" method="POST">
                                        <button class="btn btn-danger btn-sm">Remover</button>
                                    </form>
                                </td>
                            
                            <td>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% endif %}
            
        </tbody>
    </table>

    <hr class="my-4">

    <h3>Adicionar novo registro</h3>

    <form class="bg-white p-4 shadow-sm rounded" action="{{ url_for('register.add_reigster')}}" method="POST">
        <div class="mb-3">
            <label class="form-label">Descrição</label>
            <input type="text" name="description" class="form-control" placeholder="Ex: Mercado" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Valor</label>
            <input type="number" name="value" step="0.01" class="form-control" placeholder="Ex: 50.00" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Categoria</label>
            <select class="form-select" name="category" required>
                <option value="">Selecione</option>
                <option value="Alimentação">Alimentação</option>
                <option value="Assinaturas">Assinaturas</option>
                <option value="Contas">Contas</option>
                <option value="Investimentos">Investimentos</option>
                <option value="Lazer">Lazer</option>
                <option value="Mercado">Mercado</option>
                <option value="Necessidades">Necessidades</option>
                <option value="Renda Extra">Renda Extra</option>
                <option value="Roupas">Roupas</option>
                <option value="Saúde">Saúde</option>
                <option value="Transporte">Transporte</option>
                <option value="Trabalho">Trabalho</option>
                <option value="Outros">Outros</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select class="form-select" name="type" required>
                <option value="">Selecione</option>
                <option value="Renda">Renda</option>
                <option value="Necessidade">Necessidade</option>
                <option value="Desejos">Desejos</option>
                <option value="Poupança">Poupança</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Data</label>
            <input type="date" name="date" class="form-control" value="{{ actual_date }}" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Adicionar Registro</button>
    </form>
</div>
</body>
</html>
